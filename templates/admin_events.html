<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Event Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(120deg, #f6d365, #fda085);
        }
        .tag {
            background: #3498db;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .tag:hover {
            transform: scale(1.05);
        }
        .tag.selected {
            background: #2ecc71;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <header class="bg-gray-800 text-white py-4 px-6 shadow-lg">
        <h1 class="text-2xl font-bold text-center">Admin Event Management</h1>
    </header>

    <div class="container mx-auto px-4 py-8">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="mb-6 space-y-2">
                    {% for category, message in messages %}
                        <div class="p-3 rounded-lg bg-{{ 'green' if category == 'success' else 'red' }}-200 text-{{ 'green' if category == 'success' else 'red' }}-800">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <!-- Add Event Form -->
        <div class="bg-white rounded-lg shadow-xl p-6 mb-8">
            <h2 class="text-xl font-bold mb-4">Add New Event</h2>
            <form action="{{ url_for('add_event') }}" method="POST" enctype="multipart/form-data" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Event Basic Info -->
                <div class="md:col-span-2">
                    <label class="block font-medium mb-1">Event Name</label>
                    <input type="text" name="event_name" class="w-full p-2 border rounded-lg" required>
                </div>

                <div class="md:col-span-2">
                    <label class="block font-medium mb-1">Description</label>
                    <textarea name="description" class="w-full p-2 border rounded-lg" rows="3" required></textarea>
                </div>

                <!-- School and Department -->
                <div>
                    <label class="block font-medium mb-1">School</label>
                    <select id="schoolSelect" name="school" class="w-full p-2 border rounded-lg" required>
                        <option value="">-- Select School --</option>
                    </select>
                </div>

                <div>
                    <label class="block font-medium mb-1">Department</label>
                    <select id="departmentSelect" name="department" class="w-full p-2 border rounded-lg" required>
                        <option value="">-- Select Department --</option>
                    </select>
                </div>

                <!-- Event Type and Action -->
                <div>
                    <label class="block font-medium mb-1">Event Type</label>
                    <select name="event_type" class="w-full p-2 border rounded-lg" required>
                        <option value="">-- Select Event Type --</option>
                        <option value="Workshop">Workshop</option>
                        <option value="Seminar">Seminar</option>
                        <option value="Competition">Competition</option>
                        <option value="Cultural">Cultural</option>
                        <option value="Sports">Sports</option>
                    </select>
                </div>

                <div>
                    <label class="block font-medium mb-1">Event Action</label>
                    <input type="text" id="eventActionInput" name="event_action" class="w-full p-2 border rounded-lg">
                    <div id="eventTypeTags" class="flex flex-wrap gap-2 mt-2"></div>
                </div>

                <!-- Venue and Dates -->
                <div>
                    <label class="block font-medium mb-1">Venue</label>
                    <input type="text" name="venue" class="w-full p-2 border rounded-lg">
                </div>

                <div>
                    <label class="block font-medium mb-1">Event Date</label>
                    <input type="date" name="event_date" class="w-full p-2 border rounded-lg" required>
                </div>

                <div>
                    <label class="block font-medium mb-1">End Date</label>
                    <input type="date" name="end_date" class="w-full p-2 border rounded-lg">
                </div>

                <!-- File Uploads -->
                <div>
                    <label class="block font-medium mb-1">Image</label>
                    <input type="file" id="imageUpload" name="image" accept="image/*" class="w-full p-2 border rounded-lg">
                    <div id="imagePreview" class="mt-2"></div>
                </div>

                <div>
                    <label class="block font-medium mb-1">PDF</label>
                    <input type="file" id="pdfUpload" name="pdf" accept="application/pdf" class="w-full p-2 border rounded-lg">
                    <div id="pdfPreview" class="mt-2"></div>
                </div>

                <!-- Submit Button -->
                <div class="md:col-span-2">
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
                        Add Event
                    </button>
                </div>
            </form>
        </div>

        <!-- Events List -->
        <div class="bg-white rounded-lg shadow-xl p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold">Events List</h2>
                <a href="{{ url_for('add_event') }}" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
                    Add Event
                </a>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {% for event in events %}
                <div class="bg-gray-50 p-4 rounded-lg shadow border border-gray-200">
                    <h3 class="text-lg font-bold mb-2">{{ event.event_name }}</h3>
                    <p class="text-gray-600 mb-3">{{ event.description }}</p>
                    
                    <div class="space-y-1 text-sm">
                        <p><span class="font-semibold">School:</span> {{ event.school }}</p>
                        <p><span class="font-semibold">Department:</span> {{ event.department }}</p>
                        <p><span class="font-semibold">Type:</span> {{ event.event_type }}</p>
                        <p><span class="font-semibold">Date:</span> {{ event.event_date }} {% if event.end_date %} - {{ event.end_date }}{% endif %}</p>
                        <p><span class="font-semibold">Venue:</span> {{ event.venue }}</p>
                    </div>

                    {% if event.image %}
                        <img src="{{ event.image }}" class="mt-3 rounded-lg w-full h-40 object-cover border border-gray-300">
                    {% endif %}

                    {% if event.pdf %}
                        <a href="{{ event.pdf }}" target="_blank" class="inline-block mt-3 text-blue-600 hover:text-blue-800 underline">
                            View PDF
                        </a>
                    {% endif %}

                   <div class="mt-4 pt-2 border-t border-gray-200 flex gap-4">
    <a href="{{ url_for('edit_event', event_id=event._id) }}" 
       class="text-blue-600 hover:text-blue-800 font-medium">
        Edit Event
    </a>
    <a href="{{ url_for('delete_event', event_id=event._id) }}" 
       onclick="return confirm('Are you sure you want to delete this event?')" 
       class="text-red-600 hover:text-red-800 font-medium">
        Delete Event
    </a>


                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <script>
        const departmentMapping = {
            'School of Computer Science and Engineering': [
                'Department of Computer Science and Engineering',
                'Department of Information Science and Engineering'
            ],
            'School of Aerospace Engineering': [
                'Department of Aerospace Engineering'
            ],
            'School of Engineering & Technology': [
                'Department of Civil Engineering',
                'Department of Mechanical Engineering',
                'Department of Electrical and Electronics Engineering',
                'Department of Electronics and Communication Engineering',
                'Department of Food Technology'
            ],
            'School of Humanities and Social Sciences': [
                'Department of Humanities & Social Sciences',
                'Department of Economics',
                'Department of Performing Arts and Cultural Studies',
                'Department of Languages',
                'Department of Journalism and Mass Communication'
            ],
            'School of Law': [
                'Department of Law'
            ],
            'School of Sciences': [
                'Department of Chemistry and Biochemistry',
                'Department of Biotechnology and Genetics',
                'Department of Microbiology and Botany',
                'Department of Data Analytics and Mathematical Science',
                'Department of Forensic Science',
                'Department of Physics and Electronics',
                'Department of Psychology and Allied Sciences'
            ],
            'School of Allied Healthcare and Sciences': [
                'Department of Allied Healthcare and Sciences'
            ],
            'School of Sports Science & Research': [
                'Department of Allied Healthcare and Sciences'
            ],
            'School of Commerce': [
                'Department of Commerce'
            ],
            'CMS Business School': [
                'Department of Management Studies'
            ],
            'School of Aviation and Aerospace Management': [
                'Department of Management Studies'
            ],
            'School of Design, Media and Creative Arts': [
                'Department of Art and Design',
                'Department of Design'
            ],
            'School of Computer Science & Information Technology': [
                'Department of Computer Science & IT',
                'Department of Animation and Virtual Reality'
            ]
        };

        const eventTypes = [
            'lecture', 'seminar', 'workshop', 'conference', 'symposium', 'webinar',
            'training', 'orientation', 'fdp', 'guest lecture', 'event', 'nss',
            'placements', 'sdp', 'other events',
            'exam', 'midterm', 'final', 'quiz', 'viva', 'assessment',
            'competition', 'hackathon', 'cultural', 'sports', 'fest',
            'field trip', 'industrial visit', 'placement', 'career fair', 'alumni meet'
        ];

        // Initialize school and department dropdowns
        const schoolSelect = document.getElementById('schoolSelect');
        Object.keys(departmentMapping).forEach(school => {
            const opt = document.createElement('option');
            opt.value = school;
            opt.textContent = school;
            schoolSelect.appendChild(opt);
        });

        const departmentSelect = document.getElementById('departmentSelect');
        schoolSelect.addEventListener('change', function() {
            departmentSelect.innerHTML = '<option value="">-- Select Department --</option>';
            if (this.value) {
                departmentMapping[this.value].forEach(dept => {
                    const opt = document.createElement('option');
                    opt.value = dept;
                    opt.textContent = dept;
                    departmentSelect.appendChild(opt);
                });
            }
        });

        // Initialize event type tags
        const eventTypeTags = document.getElementById('eventTypeTags');
        const eventActionInput = document.getElementById('eventActionInput');
        eventTypes.forEach(type => {
            const tag = document.createElement('div');
            tag.className = 'tag';
            tag.textContent = type;
            tag.addEventListener('click', () => {
                document.querySelectorAll('.tag').forEach(t => t.classList.remove('selected'));
                tag.classList.add('selected');
                eventActionInput.value = type;
            });
            eventTypeTags.appendChild(tag);
        });

        // Image preview
        document.getElementById('imageUpload').addEventListener('change', e => {
            const file = e.target.files[0];
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = '';
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(evt) {
                    const img = document.createElement('img');
                    img.src = evt.target.result;
                    img.alt = 'Preview';
                    img.className = 'rounded-lg border border-gray-300 max-h-40';
                    preview.appendChild(img);
                }
                reader.readAsDataURL(file);
            }
        });

        // PDF preview
        document.getElementById('pdfUpload').addEventListener('change', e => {
            const file = e.target.files[0];
            const preview = document.getElementById('pdfPreview');
            preview.innerHTML = '';
            
            if (file) {
                const url = URL.createObjectURL(file);
                const iframe = document.createElement('iframe');
                iframe.src = url;
                iframe.className = 'rounded-lg border border-gray-300 w-full h-40';
                preview.appendChild(iframe);
            }
        });
    </script>
</body>
</html>