<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit Monthly Engagement</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --jain-blue: #003366;
      --jain-gold: #FFD700;
      --light-bg: #f4f4f4;
    }

    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background-color: var(--light-bg);
      margin: 0;
      padding: 0;
      padding-top: 80px;
    }

    /* Header Styles */
    .header-container {
      background-color: var(--jain-blue);
      color: white;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    .logo-section {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .logo-section img {
      height: 50px;
    }

    .logo-text {
      display: flex;
      flex-direction: column;
    }

    .logo-text h1 {
      margin: 0;
      font-size: 1.5rem;
      color: white;
      font-weight: 600;
    }

    .logo-text span {
      font-size: 0.8rem;
      color: rgba(255, 255, 255, 0.8);
    }

    .nav-links {
      display: flex;
      gap: 1.5rem;
      align-items: center;
    }

    .nav-links a {
      color: white;
      text-decoration: none;
      transition: color 0.3s;
      font-weight: 500;
      padding: 0.5rem 0;
      position: relative;
    }

    .nav-links a:hover {
      color: var(--jain-gold);
    }

    .nav-links a::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background-color: var(--jain-gold);
      transition: width 0.3s;
    }

    .nav-links a:hover::after {
      width: 100%;
    }

    .user-email {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.9);
      margin-left: 1rem;
    }

    /* Main Content Styles */
    .container {
      max-width: 900px;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    .form-container {
      background: white;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      margin-bottom: 2rem;
    }

    h2 {
      color: var(--jain-blue);
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--jain-gold);
    }

    /* Form Styles */
    .form-group {
      margin-bottom: 1.5rem;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: #444;
    }

    input[type="text"],
    input[type="file"],
    select,
    textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 1rem;
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    input[type="text"]:focus,
    input[type="file"]:focus,
    select:focus,
    textarea:focus {
      border-color: var(--jain-blue);
      box-shadow: 0 0 0 3px rgba(0, 51, 102, 0.1);
      outline: none;
    }

    textarea {
      min-height: 120px;
      resize: vertical;
    }

    .checkbox-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 0.75rem;
      margin-top: 0.5rem;
    }

    .checkbox-label {
      display: flex;
      align-items: center;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 5px;
      transition: background 0.2s;
    }

    .checkbox-label:hover {
      background: rgba(0, 51, 102, 0.05);
    }

    .checkbox-label input {
      margin-right: 0.75rem;
      width: 1.1em;
      height: 1.1em;
    }

    /* File Preview Styles */
    .file-preview {
      margin: 1.5rem 0;
    }

    .file-preview h3 {
      font-size: 1.1rem;
      color: #555;
      margin-bottom: 0.75rem;
    }

    .image-preview {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .image-preview img {
      width: 120px;
      height: 120px;
      object-fit: cover;
      border-radius: 5px;
      border: 1px solid #ddd;
      transition: transform 0.3s;
    }

    .image-preview img:hover {
      transform: scale(1.05);
    }

    .pdf-list {
      list-style-type: none;
      padding: 0;
    }

    .pdf-list li {
      margin-bottom: 0.5rem;
    }

    .pdf-list a {
      color: var(--jain-blue);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem;
      border-radius: 5px;
      transition: background 0.2s;
    }

    .pdf-list a:hover {
      background: rgba(0, 51, 102, 0.05);
      text-decoration: underline;
    }

    /* Button Styles */
    .btn-submit {
      background-color: var(--jain-blue);
      color: white;
      padding: 0.75rem 1.75rem;
      border: none;
      border-radius: 5px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
      margin-top: 1rem;
    }

    .btn-submit:hover {
      background-color: #002244;
      transform: translateY(-2px);
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .header-container {
        flex-direction: column;
        padding: 1rem 0.5rem;
      }

      .logo-section {
        margin-bottom: 1rem;
      }

      .nav-links {
        flex-wrap: wrap;
        justify-content: center;
        gap: 1rem;
      }

      .form-container {
        padding: 1.5rem;
      }

      .checkbox-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-container">
      <div class="logo-section">
        <img src="{{ url_for('static', filename='images/logo12345.png') }}" alt="Jain University Logo">
        <div class="logo-text">
          <h1>Jain University</h1>
          <span>Jain Group Of Institutions</span>
        </div>
      </div>
      <nav class="nav-links">
        <a href="{{ url_for('about') }}">About Us</a>
        <a href="{{ url_for('edit_ugc') }}">UGC Requirement</a>
        <a href="{{ url_for('edit_monthly') }}">Edit Monthly Engagement</a>
        <a href="{{ url_for('logout') }}" class="logout-link" onclick="return confirm('Are you sure you want to logout?')">Logout</a>
        <div class="user-email">{{ session['email'] }}</div>
      </nav>
    </div>
  </header>

  <div class="container">
    <div class="form-container">
      <h2>Edit Monthly Engagement Record</h2>
      <form method="POST" enctype="multipart/form-data" action="{{ url_for('edit_record', record_id=record._id) }}">
        
        <!-- School -->
        <div class="form-group">
          <label for="school">School</label>
          <select name="school" id="school" class="w-full border px-4 py-2 rounded">
            <option value="" disabled>Select School</option>
            {% set school_list = [
              "School of Computer Science and Engineering",
              "School of Aerospace Engineering",
              "School of Engineering & Technology",
              "School of Humanities and Social Sciences",
              "School of Law",
              "School of Sciences",
              "School of Allied Healthcare and Sciences",
              "School of Sports Science & Research",
              "School of Computer Science & Information Technology",
              "School of Commerce",
              "CMS Business School",
              "School of Aviation and Aerospace Management",
              "School of Design, Media and Creative Arts"
            ] %}
            {% for school in school_list %}
              <option value="{{ school }}" {% if record.school == school %}selected{% endif %}>{{ school }}</option>
            {% endfor %}
          </select>
        </div>

        <!-- Heading -->
        <div class="form-group">
          <label for="heading">Heading</label>
          <input type="text" name="heading" id="heading" value="{{ record.heading }}">
        </div>

        <!-- Description -->
        <div class="form-group">
          <label for="description">Description</label>
          <textarea name="description" id="description">{{ record.description }}</textarea>
        </div>

        <!-- Department -->
        <div class="form-group">
          <label for="department">Department</label>
          <select name="department" id="department">
            <option value="" disabled {% if not record.department %}selected{% endif %}>Select Department</option>
            {% for dept in departments %}
              <option value="{{ dept }}" {% if record.department == dept %}selected{% endif %}>{{ dept }}</option>
            {% endfor %}
          </select>
        </div>

        <!-- Tags -->
        <div class="form-group">
          <label>Tags (choose 1 or more)</label>
          <div class="checkbox-container">
            {% set tag_options = ['Sports', 'Education', 'Examination', 'Events', 'Co-Curricular Activities'] %}
            {% for tag in tag_options %}
              <label class="checkbox-label">
                <input type="checkbox" name="tags" value="{{ tag }}" {% if tag in record.tags %}checked{% endif %}>
                <span>{{ tag }}</span>
              </label>
            {% endfor %}
          </div>
        </div>

        <!-- Existing Files -->
        {% if record.files %}
          <!-- Existing Images -->
          <div class="file-preview">
            <h3>Previously Uploaded Images</h3>
            <div class="image-preview">
              {% for file in record.files %}
                {% if file.endswith(('.png', '.jpg', '.jpeg', '.webp')) %}
                  <img src="{{ url_for('uploaded_file', filename=file) }}" alt="Uploaded Image">
                {% endif %}
              {% endfor %}
            </div>
          </div>

          <!-- Existing PDFs -->
          <div class="file-preview">
            <h3>Previously Uploaded PDFs</h3>
            <ul class="pdf-list">
              {% for file in record.files %}
                {% if file.endswith('.pdf') %}
                  <li>
                    <a href="{{ url_for('uploaded_file', filename=file) }}" target="_blank">
                      <span>📄</span>
                      <span>{{ file }}</span>
                    </a>
                  </li>
                {% endif %}
              {% endfor %}
            </ul>
          </div>
        {% endif %}

        <!-- Upload New Files -->
        <div class="form-group">
          <label for="image-upload">Upload New Image (optional)</label>
          <input type="file" id="image-upload" name="files" accept="image/*">
        </div>

        <div class="form-group">
          <label for="pdf-upload">Upload New PDF (optional)</label>
          <input type="file" id="pdf-upload" name="files" accept="application/pdf">
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn-submit">Update Record</button>
      </form>
    </div>
  </div>

  <script>
    const departmentsBySchool = {
      "School of Computer Science and Engineering": [
        "Department of Computer Science and Engineering",
        "Department of Information Science and Engineering"
      ],
      "School of Aerospace Engineering": [
        "Department of Aerospace Engineering"
      ],
      "School of Engineering & Technology": [
        "Department of Civil Engineering",
        "Department of Mechanical Engineering",
        "Department of Electrical and Electronics Engineering",
        "Department of Electronics and Communication Engineering",
        "Department of Food Technology"
      ],
      "School of Humanities and Social Sciences": [
        "Department of Humanities & Social Sciences",
        "Department of Economics",
        "Department of Performing Arts and Cultural Studies",
        "Department of Languages",
        "Department of Journalism and Mass Communication"
      ],
      "School of Law": ["Department of Law"],
      "School of Sciences": [
        "Department of Chemistry and Biochemistry",
        "Department of Biotechnology and Genetics",
        "Department of Microbiology and Botany",
        "Department of Data Analytics and Mathematical Science",
        "Department of Forensic Science",
        "Department of Physics and Electronics",
        "Department of Psychology and Allied Sciences"
      ],
      "School of Allied Healthcare and Sciences": ["Department of Allied Healthcare and Sciences"],
      "School of Sports Science & Research": ["Department of Allied Healthcare and Sciences"],
      "School of Computer Science & Information Technology": [
        "Department of Computer Science and IT",
        "Department of Animation and Virtual Reality"
      ],
      "School of Commerce": ["Department of Commerce"],
      "CMS Business School": ["Department of Management Studies"],
      "School of Aviation and Aerospace Management": ["Department of Management Studies"],
      "School of Design, Media and Creative Arts": [
        "Department of Design",
        "Department of Art and Design"
      ]
    };

    function populateDepartments(selectedSchool) {
      const departmentSelect = document.getElementById("department");
      departmentSelect.innerHTML = '<option value="" disabled selected>Select Department</option>';

      if (selectedSchool && departmentsBySchool[selectedSchool]) {
        departmentsBySchool[selectedSchool].forEach(dept => {
          const option = document.createElement("option");
          option.value = dept;
          option.text = dept;
          {% if record.department %}
          if (dept === "{{ record.department }}") {
            option.selected = true;
          }
          {% endif %}
          departmentSelect.appendChild(option);
        });
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      const schoolSelect = document.getElementById("school");
      schoolSelect.addEventListener("change", () => {
        populateDepartments(schoolSelect.value);
      });

      // Pre-populate departments if school already selected
      populateDepartments(schoolSelect.value);
    });
  </script>
</body>
</html>